# Update package list
sudo apt update

# Install Python & pip (if not already)
sudo apt install python3 python3-pip -y

# Install Ansible
sudo apt install ansible -y

# Check version
ansible --version

# Create Ansible lab folder
mkdir ~/ansible-lab
cd ~/ansible-lab

# Create subfolders
mkdir playbooks inventory roles group_vars host_vars templates

# Generate SSH key
ssh-keygen -t rsa -b 4096 -C "ansible@controlnode"
# (Press Enter for all prompts, no passphrase)

# View public key
cat ~/.ssh/id_rsa.pub
# Copy this to each target server:
#   mkdir -p ~/.ssh
#   nano ~/.ssh/authorized_keys   # Paste the key
#   chmod 600 ~/.ssh/authorized_keys

cd ~/ansible-lab
nano inventory.ini
#paste this code in the inventory.ini
[control]
localhost ansible_connection=local

[webservers]
web1 ansible_host=13.232.111.111 ansible_user=ubuntu
web2 ansible_host=13.232.222.222 ansible_user=ubuntu

[webservers:vars]
ansible_ssh_private_key_file=~/.ssh/id_rsa
ansible_ssh_common_args='-o StrictHostKeyChecking=no'

[all:vars]
ansible_python_interpreter=/usr/bin/python3


nano ansible.cfg
#paste this code into ansible.cfg
[defaults]
inventory = inventory.ini
remote_user = ubuntu
private_key_file = ~/.ssh/id_rsa
host_key_checking = False
timeout = 30
pipelining = True

[ssh_connection]
ssh_args = -o ControlMaster=auto -o ControlPersist=60s


# Check all inventory details
ansible-inventory --list --yaml

# Ping all hosts
ansible all -m ping

###.Run frist playbook
cd ~/ansible-lab/playbooks
nano first-playbook.yml
#paste it in the frist playbook file
---
- name: First Ansible Playbook
  hosts: webservers
  become: yes
  tasks:
    - name: Update apt package cache
      apt:
        update_cache: yes

    - name: Install htop
      apt:
        name: htop
        state: present

